<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Weaving Relations – Mandala Diagram</title>
  <style>
    :root {
      --bg: #0b1020;
      --fg: #f6f5f2;
      --accent-eu: #4ea0ff;
      --accent-prov: #ffb347;
      --accent-mun: #6cd47b;
      --segment: #7f8cff;
      --segment-muted: #323954;
    }

    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }

    body {
      margin: 0;
      background: radial-gradient(circle at top, #1b2140, #050711 60%);
      color: var(--fg);
      min-height: 100vh;
      font-size: 14px;
    }

    .mandala-wrapper {
      display: grid;
      grid-template-columns: 1fr; /* vertical layout: mandala on top, info below */
      gap: 1.5rem;
      padding: 1.5rem 1.25rem 2.5rem;
      max-width: 700px;
      width: 100%;
      margin: 0 auto 2.5rem;
    }

    .mandala-svg-container {
      position: relative;
      width: 100%;
      padding-bottom: 100%; /* square */
    }

    svg {
      position: absolute;
      inset: 0;
      width: 100%;
      height: 100%;
    }

    .info-panel {
      display: flex;
      flex-direction: column;
      gap: 0.75rem;
    }

    .info-panel h1 {
      font-size: 1.1rem;
      letter-spacing: 0.06em;
      text-transform: uppercase;
      color: #c2c8ff;
      margin: 0;
    }

    .info-panel h2 {
      font-size: 0.9rem;
      margin: 0.15rem 0 0.3rem;
      color: #ffffff;
    }

    .info-panel p {
      margin: 0;
      font-size: 0.8rem;
      line-height: 1.4;
      color: #d0d4f5;
    }

    .chips {
      display: flex;
      flex-wrap: wrap;
      gap: 0.4rem;
      margin-top: 0.4rem;
    }

    .chip {
      font-size: 0.6rem;
      padding: 0.18rem 0.5rem;
      border-radius: 999px;
      border: 1px solid rgba(194, 200, 255, 0.3);
      color: #c2c8ff;
      background: rgba(16, 27, 68, 0.7);
      backdrop-filter: blur(8px);
    }

    .legend {
      display: flex;
      flex-wrap: wrap;
      gap: 0.6rem;
      margin-top: 1rem;
      border-top: 1px solid rgba(81, 93, 168, 0.6);
      padding-top: 0.75rem;
    }

    .legend-item {
      display: inline-flex;
      align-items: center;
      gap: 0.3rem;
      font-size: 0.7rem;
      color: #9fa6ff;
    }

    .legend-color {
      width: 10px;
      height: 10px;
      border-radius: 999px;
    }

    .legend-color.eco { background: var(--segment); }
    .legend-color.eh  { background: var(--accent-prov); }
    .legend-color.eu  { background: var(--accent-eu); }
    .legend-color.mun { background: var(--accent-mun); }

    /* Hover states from SVG */
    .segment,
    .actor-arc {
      cursor: pointer;
      transition: fill 0.2s ease, opacity 0.2s ease, stroke-width 0.2s ease;
    }

    .segment {
      fill: var(--segment-muted);
      stroke: rgba(151, 164, 255, 0.3);
      stroke-width: 1;
      opacity: 0.8;
    }

    .segment.active {
      fill: var(--segment);
      opacity: 1;
      stroke-width: 2;
    }

    .actor-arc {
      opacity: 0.5;
      stroke: rgba(0, 0, 0, 0.4);
      stroke-width: 1;
    }

    .actor-arc.eu     { fill: var(--accent-eu); }
    .actor-arc.prov   { fill: var(--accent-prov); }
    .actor-arc.mun    { fill: var(--accent-mun); }

    .actor-arc.active {
      opacity: 0.9;
      stroke-width: 2;
    }

    .center-circle {
      fill: #12172e;
      stroke: #848dff;
      stroke-width: 2;
    }

    .center-icon {
      fill: none;
      stroke: #e6edf9;
      stroke-width: 1.4;
      stroke-linecap: round;
      stroke-linejoin: round;
      opacity: 0.95;
    }

    .center-text {
      font-size: 0.6rem;
      text-anchor: middle;
      fill: #cfd5ff;
      letter-spacing: 0.08em;
      text-transform: uppercase;
    }

    .segment-label {
      font-size: 0.45rem;
      fill: #d3d7ff;
      text-anchor: middle;
      pointer-events: none;
    }

    .actor-label {
      font-size: 0.45rem;
      fill: #d3d7ff;
      text-anchor: middle;
      pointer-events: none;
    }

    
    }
  </style>
</head>
<body>
<div class="mandala-wrapper">
  <div class="mandala-svg-container">
    <svg id="mandala" viewBox="-120 -120 240 240" aria-labelledby="title desc" xmlns:xlink="http://www.w3.org/1999/xlink">
      <title id="title">Weaving Relations Mandala</title>
      <desc id="desc">
        Radial diagram showing human governance actors and the crayfish ecosystem around Cornelis Douwes.
      </desc>

      <!-- Groups for ordering -->
      <g id="ecosystem-layer"></g>
      <g id="actors-layer"></g>

      <!-- Center: American crayfish -->
      <circle class="center-circle" cx="0" cy="0" r="22"></circle>
      <!-- simple crayfish-like icon -->
      <g class="center-icon">
        <path d="M -10 0 C -6 -4 -2 -6 0 -6 C 2 -6 6 -4 10 0" />
        <path d="M -10 0 C -6 4 -2 6 0 6 C 2 6 6 4 10 0" />
        <path d="M 0 -6 L 0 -12" />
        <path d="M 0 6 L 0 12" />
        <path d="M -6 -2 L -12 -6" />
        <path d="M 6 -2 L 12 -6" />
      </g>
      
    </svg>
  </div>

  <aside class="info-panel" id="info">
    <h1>Mandala – Governance & Ecosystem</h1>
    <h2 id="info-title">Hover a segment</h2>
    <p id="info-body">
      Move over an ecosystem segment or governance arc in the mandala to explore how human actors (EU, province, municipality) intersect with the American crayfish and its more-than-human habitat around Cornelis Douwes.
    </p>
    <div class="chips" id="info-tags">
      <span class="chip">EU invasive species list</span>
      <span class="chip">Industrial heritage</span>
      <span class="chip">Circular city 2050</span>
      <span class="chip">Non-human ecosystem</span>
    </div>

    <div class="legend">
      <div class="legend-item">
        <span class="legend-color eco"></span>
        Ecosystem segments
      </div>
      <div class="legend-item">
        <span class="legend-color eu"></span>
        EU – invasive species list
      </div>
      <div class="legend-item">
        <span class="legend-color eh"></span>
        Province – industrial heritage
      </div>
      <div class="legend-item">
        <span class="legend-color mun"></span>
        Municipality – housing & circular 2050
      </div>
    </div>
  </aside>
</div>

<script>
  // ----- Data definition -----
  const ecosystemSegments = [
    {
      id: "native-crayfish",
      label: "Native crayfish",
      description:
        "European crayfish species form a vulnerable link in this system. The invasive American crayfish displaces them and exposes them to the plague it carries. Around Cornelis Douwes, refugia disappear, food webs are disturbed and potential reintroduction sites are fragmented. Bringing native crayfish back requires controlled habitats with cooler water, shaded structures and sheltered zones where the invasive species cannot easily enter. It turns conservation into a design question: how can architecture host recovery rather than only protection?",
      tags: ["biodiversity", "competition", "vulnerability"]
    },
    {
      id: "predators",
      label: "Predators",
      description:
        "Predators are the natural counterweight to overpopulation. Eel and pike regulate juvenile crayfish, while herons target larger specimens. These species themselves are under pressure from poor water quality, barriers in migration routes and the loss of spawning grounds. When predators decline, American crayfish numbers can explode. Restoring eel, pike and heron is therefore not just romantic nature thinking, but a pragmatic measure for balance. Soft banks, fish passages and quiet zones become key design tools in this scenario.",
      tags: ["food web", "top-down control"]
    },
    {
      id: "river-banks",
      label: "Erosion",
      description:
        "American crayfish dig burrows in sloping banks and under industrial quays. On the Cornelis Douwes waterfront this undermines sheet piles, quay walls and foundations, accelerating erosion and subsidence – the kind of ‘trouble’ that starts your project. Most of this erosion is invisible until it suddenly becomes structural damage. The segment invites a different attitude: instead of only resisting erosion, infrastructure could be designed to anticipate it with adaptable edges, porous structures and sacrificial zones where change is allowed.",
      tags: ["erosion", "morphology", "heritage risk"]
    },
    {
      id: "water-quality",
      label: "Water quality",
      description:
        "Oxygen is the currency of this ecosystem. During hot summers, O₂ levels can drop below critical thresholds and the American crayfish remains active where fish suffocate. Combined sewer overflows, microplastics, PFAS and urban heat all shift the water chemistry. Design interventions like shaded banks, cool water buffers, planted shelves and low-energy aeration can prevent tipping points. In the mandala this segment shows that water quality is not an abstract parameter, but the main selector for which species can stay and which are pushed out.",
      tags: ["chemistry", "urban runoff", "climate stress"]
    },
    {
      id: "aquatic-plants",
      label: "Aquatic plants",
      description:
        "Aquatic plants are the structural framework of the underwater landscape. They slow currents, filter light, produce oxygen and create microhabitats. In harbour basins they are suppressed by shipping, waves and digging crayfish. Yet they are essential for ecological repair – and for your design logic of symbiotic relations. Reintroducing robust species such as pondweed or watermilfoil can stabilise sediments, provide refuge for fish fry and insects, and expand the carrying capacity of the whole system.",
      tags: ["habitat", "oxygen", "stabilisation"]
    },
    {
      id: "detritus",
      label: "Detritus",
      description:
        "The canal bed is a continuous recycling engine. Dead leaves, wood, silt and fish remains form food for crayfish, worms and microbes. When American crayfish dominate, they accelerate breakdown, churn up sediments and make the water more turbid. This reduces light penetration and stresses aquatic plants. The segment highlights how slow, stable decay processes support ecological calm – and how your project reinterprets decomposition as a design principle instead of waste.",
      tags: ["nutrient cycling", "decomposition"]
    },
    {
      id: "insects",
      label: "Insects & larvae",
      description:
        "Aquatic insects connect water and land. Dragonfly nymphs, caddisflies and mosquito larvae are sensitive to sediment disturbance and changes in bank structure. American crayfish eat their eggs, cocoons and larval stages and disturb their microhabitats by digging. Fewer insects mean fewer birds and fewer pollinators in the wider urban system. This segment makes visible how one invasive species cascades into a much broader decline of biomass and urban biodiversity.",
      tags: ["trophic link", "sensitive indicators"]
    },
    {
      id: "fish-eggs",
      label: "Fish eggs",
      description:
        "Fish recruitment is one of the first casualties of crayfish overpredation. Eggs and fry of bream, perch or pike are an easy, energy-rich food for American crayfish. As recruitment fails, fish populations age and shrink, and the entire food web shifts. In a city like Amsterdam, where fisheries management is already under pressure, this can push certain species to local disappearance. The segment underlines the importance of sheltered spawning grounds, gravel beds and shallow marshy fringes that protect eggs from nocturnal grazers.",
      tags: ["recruitment", "predation pressure"]
    },
    {
      id: "plague",
      label: "Crayfish plague",
      description:
        "Crayfish plague is an invisible but decisive actor. The oomycete pathogen Aphanomyces astaci spreads quickly through water and contact. It is lethal to European crayfish, while the American species carries it without dying. In a dense urban water network this creates a strong asymmetry: the survivor determines who disappears. In your project this segment mirrors the broader theme of binding versus breaking – a system where contact and connectivity can be both life-giving and fatal.",
      tags: ["pathogen", "EU regulation", "extinction risk"]
    }
  ];

  // Three human actors as outer arcs, each covering 1/3 of the circle
  const actors = [
    {
      id: "eu",
      label: "EU – invasive species list",
      description:
        "The European Union defines the legal status of the American crayfish by placing it on the Union list of invasive alien species. That brings restrictions on trade, transport and intentional release, while also creating a framework for control and restoration projects. At the same time, EU research and innovation agendas stimulate work on biomaterials, circular production and ecological monitoring – exactly the space your project occupies. The EU layer is both a constraint and a design opportunity.",
      tags: ["IAS policy", "regulation", "bans"]
    },
    {
      id: "province",
      label: "Province – industrial heritage",
      description:
        "The province acts as guardian of continuity between past and future. Industrial heritage around Cornelis Douwes – factories, silos and quay structures – is culturally valuable and also forms physical infrastructure within the ecosystem. These structures are now literally undermined by crayfish burrows. Provincial policy seeks ways to connect heritage, ecology and new economies. In the mandala this arc frames your intervention as a transformation of heritage, not just its conservation, with the crayfish as an active co-designer.",
      tags: ["heritage", "riverfront morphology", "spatial rules"]
    },
    {
      id: "municipality",
      label: "Municipality – housing & circular 2050",
      description:
        "Amsterdam aims to become a fully circular city while also delivering new housing, climate adaptation and space for urban industry. The municipality has to balance densification, quay reinforcement, water quality targets and ecological ambitions along the IJ. In this tension field, the American crayfish is both a threat to infrastructure and an abundant local resource. This segment shows how a local nuisance can be reframed as circular potential: shells as material, lifecycles as design guides and new forms of urban work that entangle ecology and production.",
      tags: ["housing", "circular economy", "urban ecology"]
    }
  ];

  // ----- Geometry helpers -----
  function polarToCartesian(cx, cy, r, angleDeg) {
    const rad = (angleDeg - 90) * (Math.PI / 180);
    return {
      x: cx + r * Math.cos(rad),
      y: cy + r * Math.sin(rad)
    };
  }

  function describeArcSector(cx, cy, innerR, outerR, startAngle, endAngle) {
    const startOuter = polarToCartesian(cx, cy, outerR, endAngle);
    const endOuter   = polarToCartesian(cx, cy, outerR, startAngle);
    const startInner = polarToCartesian(cx, cy, innerR, startAngle);
    const endInner   = polarToCartesian(cx, cy, innerR, endAngle);

    const largeArc = endAngle - startAngle <= 180 ? "0" : "1";

    return [
      "M", startOuter.x, startOuter.y,
      "A", outerR, outerR, 0, largeArc, 0, endOuter.x, endOuter.y,
      "L", startInner.x, startInner.y,
      "A", innerR, innerR, 0, largeArc, 1, endInner.x, endInner.y,
      "Z"
    ].join(" ");
  }

  // ----- Build SVG -----
  const svg = document.getElementById("mandala");
  const ecoLayer = document.getElementById("ecosystem-layer");
  const actorsLayer = document.getElementById("actors-layer");

  const ecoInnerR = 28;
  const ecoOuterR = 75;
  const actorInnerR = 78;
  const actorOuterR = 105;

  const ecoCount = ecosystemSegments.length;
  const ecoAngleStep = 360 / ecoCount;

  // ecosystem segments
  ecosystemSegments.forEach((seg, i) => {
    const start = i * ecoAngleStep;
    const end = start + ecoAngleStep;

    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("d", describeArcSector(0, 0, ecoInnerR, ecoOuterR, start, end));
    path.classList.add("segment");
    path.dataset.id = seg.id;
    path.dataset.type = "ecosystem";
    ecoLayer.appendChild(path);

    // label position at mid angle
    const mid = start + ecoAngleStep / 2;
    const labelRadius = (ecoInnerR + ecoOuterR) / 2; // halfway the segment thickness
    const labelPos = polarToCartesian(0, 0, labelRadius, mid);
    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
    text.classList.add("segment-label");
    text.setAttribute("x", labelPos.x);
    text.setAttribute("y", labelPos.y);

    // inner ring: rotate all labels 90° relative to the radial line (tangential)
    let innerRotation = mid + 90;
    if (innerRotation > 180) {
      innerRotation -= 180; // keep text mostly upright
    }
    text.setAttribute("transform", `rotate(${innerRotation} ${labelPos.x} ${labelPos.y})`);

    text.textContent = seg.label;
    ecoLayer.appendChild(text);
  });

  // actors as three arcs each 120°
  const actorAngleSpan = 360 / actors.length;
  actors.forEach((actor, i) => {
    const start = i * actorAngleSpan;
    const end = start + actorAngleSpan;

    // main colored arc
    const path = document.createElementNS("http://www.w3.org/2000/svg", "path");
    path.setAttribute("d", describeArcSector(0, 0, actorInnerR, actorOuterR, start, end));
    path.classList.add("actor-arc");
    path.classList.add(
      actor.id === "eu" ? "eu" : actor.id === "province" ? "prov" : "mun"
    );
    path.dataset.id = actor.id;
    path.dataset.type = "actor";
    actorsLayer.appendChild(path);

    // curved label path just outside the actor ring
    const labelRadius = actorOuterR + 8;
    const labelPathId = `actor-label-path-${actor.id}`;

    const startPoint = polarToCartesian(0, 0, labelRadius, end);
    const endPoint   = polarToCartesian(0, 0, labelRadius, start);
    const largeArcFlag = actorAngleSpan <= 180 ? 0 : 1;

    const labelPath = document.createElementNS("http://www.w3.org/2000/svg", "path");
    labelPath.setAttribute("id", labelPathId);
    labelPath.setAttribute(
      "d",
      [
        "M", startPoint.x, startPoint.y,
        "A", labelRadius, labelRadius, 0, largeArcFlag, 0, endPoint.x, endPoint.y
      ].join(" ")
    );
    labelPath.setAttribute("fill", "none");
    labelPath.setAttribute("stroke", "none");
    actorsLayer.appendChild(labelPath);

    // text that follows the curved path
    const text = document.createElementNS("http://www.w3.org/2000/svg", "text");
    text.classList.add("actor-label");

    const textPath = document.createElementNS("http://www.w3.org/2000/svg", "textPath");
    textPath.setAttributeNS("http://www.w3.org/1999/xlink", "xlink:href", `#${labelPathId}`);
    textPath.setAttribute("startOffset", "50%");
    textPath.setAttribute("text-anchor", "middle");
    textPath.textContent = actor.label;

    text.appendChild(textPath);
    actorsLayer.appendChild(text);
  });

  // ----- Interaction -----
  const infoTitle = document.getElementById("info-title");
  const infoBody = document.getElementById("info-body");
  const infoTags = document.getElementById("info-tags");

  function setInfoFromDataset(type, id) {
    let data;
    if (type === "ecosystem") {
      data = ecosystemSegments.find(s => s.id === id);
    } else {
      data = actors.find(a => a.id === id);
    }
    if (!data) return;

    infoTitle.textContent = data.label;
    infoBody.textContent = data.description;
    infoTags.innerHTML = "";
    (data.tags || []).forEach(tag => {
      const span = document.createElement("span");
      span.className = "chip";
      span.textContent = tag;
      infoTags.appendChild(span);
    });
  }

  function resetHighlights() {
    document.querySelectorAll(".segment").forEach(el => el.classList.remove("active"));
    document.querySelectorAll(".actor-arc").forEach(el => el.classList.remove("active"));
  }

  function setupHover() {
    svg.addEventListener("mouseover", (e) => {
      const target = e.target;
      const type = target.dataset && target.dataset.type;
      const id = target.dataset && target.dataset.id;
      if (!type || !id) return;

      resetHighlights();
      target.classList.add("active");
      setInfoFromDataset(type, id);
    });

    svg.addEventListener("mouseleave", () => {
      resetHighlights();
      infoTitle.textContent = "Hover a segment";
      infoBody.textContent =
        "Move over an ecosystem segment or governance arc in the mandala to explore how human actors (EU, province, municipality) intersect with the American crayfish and its more-than-human habitat around Cornelis Douwes.";
      infoTags.innerHTML = `
        <span class="chip">EU invasive species list</span>
        <span class="chip">Industrial heritage</span>
        <span class="chip">Circular city 2050</span>
        <span class="chip">Non-human ecosystem</span>
      `;
    });
  }

  setupHover();
</script>
</body>
</html>
